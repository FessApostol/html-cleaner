<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>–û—á–∏—â—É–≤–∞—á HTML (MVP) ‚Äî –≤–µ—Ä—Å—ñ—è 21</title>
  <style>
    /* ===== –¢–ï–ú–ò ========================================================== */
    :root{
      --bg: #0b1020;
      --bg-soft:#0f1630;
      --bg-softer:#0e1431;
      --panel-top:#121a3a;
      --bd:#1b2445;
      --ink:#e7ecf7;
      --ink-dim:#a8b5d9;
      --brand:#2952ff;
      --brand-bd:#4669ff;
      --code-bg:#0a112b;
      --code-ink:#d7e1ff;
      --muted:#26325f;
      --gap:14px;
      --code-size:14px;
    }
    .theme-light{
      --bg:#f6f8ff;
      --bg-soft:#ffffff;
      --bg-softer:#f4f6ff;
      --panel-top:#eef1ff;
      --bd:#dfe5ff;
      --ink:#0e1220;
      --ink-dim:#47507a;
      --brand:#2151ff;
      --brand-bd:#4f73ff;
      --code-bg:#0b1020;
      --code-ink:#e7ecf7;
      --muted:#c9d3ff;
    }

    /* ===== –ë–ê–ó–ê ========================================================= */
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; background:var(--bg); color:var(--ink);
      font:16px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
    }
    header{
      position:sticky; top:0; z-index:10;
      display:flex; align-items:center; justify-content:space-between;
      padding:14px 16px; border-bottom:1px solid var(--bd); background:var(--bg-soft);
    }
    header h1{margin:0; font-size:16px; font-weight:600}
    .theme-toggle{
      display:inline-flex; align-items:center; gap:8px;
      background:transparent; border:1px solid var(--bd); color:var(--ink);
      padding:6px 10px; border-radius:999px; cursor:pointer;
    }

    .wrap{padding:16px; display:grid; gap:var(--gap); grid-template-columns:1fr 1fr}
    .panel{
      background:var(--bg-soft); border:1px solid var(--bd);
      border-radius:10px; display:flex; flex-direction:column; overflow:hidden;
      min-height:360px;
    }
    .panel h2{margin:0; padding:10px 12px; background:var(--panel-top); border-bottom:1px solid var(--bd); font-size:14px}
    .toolbar{
      display:flex; flex-wrap:wrap; gap:6px; padding:8px 10px;
      border-bottom:1px solid var(--bd); background:var(--bg-softer)
    }
    .toolbar button, .toolbar select{
      background:#16224a; color:var(--ink); border:1px solid #2a3a78;
      padding:6px 10px; border-radius:8px; font-size:13px; cursor:pointer
    }
    .theme-light .toolbar button, .theme-light .toolbar select{background:#eef1ff; color:#0e1220; border-color:#dfe5ff}
    .toolbar button:hover{filter:brightness(1.1)}
    .toolbar select{min-width:110px}

    /* –†–ï–î–ê–ö–¢–û–† ‚Äî –¥–µ–ª–∞–µ–º —Ö–æ—Ä–æ—à–æ —á–∏—Ç–∞–µ–º—ã–º –≤ –Ω–æ—á–Ω–æ–π —Ç–µ–º–µ */
    #editor{
      padding:12px; height:520px; overflow:auto; outline:none; resize:vertical;
      line-height:1.6; -webkit-user-modify:read-write-plaintext-only;
    }
    /* —á–∏—Ç–∞–µ–º–æ—Å—Ç—å: –≤–µ—Å—å –≤—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ ‚Äî —Å–≤–µ—Ç–ª—ã–π */
    #editor, #editor *{ color:var(--ink)!important; background:transparent!important; }
    #editor:empty:before{content:'–í—Å—Ç–∞–≤—Ç–µ –∞–±–æ –Ω–∞–ø–∏—à—ñ—Ç—å —Ç–µ–∫—Å—Ç —Ç—É—Ç‚Ä¶'; color:var(--ink-dim)}

    /* –ö–æ–¥ */
    #code{
      width:100%; height:520px; resize:vertical; outline:none; overflow:auto;
      background:var(--code-bg); color:var(--code-ink);
      border:0; padding:12px;
      font:var(--code-size)/1.5 ui-monospace,SFMono-Regular,Menlo,Consolas,"Liberation Mono",monospace;
    }
    .foot-btns{display:flex; gap:8px; padding:10px; border-top:1px solid var(--bd); background:var(--bg-softer)}
    .btn{background:var(--brand); border:1px solid var(--brand-bd); color:#fff; padding:9px 12px; border-radius:10px; font-size:14px; cursor:pointer}
    .btn.secondary{background:transparent; color:var(--ink); border:1px solid var(--bd)}
    .btn:disabled{opacity:.6; cursor:not-allowed}

    /* –ù–∏–∂–Ω—ñ–π –±–ª–æ–∫ */
    .lower{grid-column:1/-1; display:grid; grid-template-columns:1fr 1fr; gap:var(--gap)}
    .card{background:var(--bg-soft); border:1px solid var(--bd); border-radius:10px; padding:10px 12px 12px}
    .card h3{margin:4px 0 10px; font-size:14px; font-weight:600}
    .sub{display:block; margin:-6px 0 10px; color:var(--ink-dim); font-size:12px}
    .options{columns:2; column-gap:22px}
    .options label{display:block; break-inside:avoid; margin:6px 0; font-size:13px; cursor:pointer}
    .options input{margin-right:6px}
    .cols{display:grid; grid-template-columns:1fr 1fr; gap:14px}
    .col h4{margin:0 0 8px; font-size:13px; color:var(--ink-dim)}
    .find-row{display:grid; grid-template-columns:1fr 1fr auto; gap:8px; margin:8px 0}
    .find-row input{background:var(--code-bg); color:var(--code-ink); border:1px solid var(--bd); border-radius:8px; padding:8px 10px; font-size:13px}
    .hr{border-top:1px dashed var(--muted); margin:10px 0}

    @media (max-width:1100px){ .wrap{grid-template-columns:1fr} .lower{grid-template-columns:1fr} }
  </style>
</head>
<body class="theme-dark">
  <header>
    <h1>–û—á–∏—â—É–≤–∞—á HTML (MVP) ‚Äî –≤–µ—Ä—Å—ñ—è 21</h1>
    <button id="themeBtn" class="theme-toggle" type="button" aria-label="–ü–µ—Ä–µ–º–∫–Ω—É—Ç–∏ —Ç–µ–º—É"><span id="themeIcon">üåô</span><span id="themeText">–ù—ñ—á–Ω–∞ —Ç–µ–º–∞</span></button>
  </header>

  <main class="wrap">
    <!-- –õ–Ü–í–ê –ü–ê–ù–ï–õ–¨ -->
    <section class="panel" aria-label="–¢–µ–∫—Å—Ç">
      <h2>–¢–µ–∫—Å—Ç</h2>
      <div class="toolbar" aria-label="–§–æ—Ä–º–∞—Ç—É–≤–∞–Ω–Ω—è">
        <select id="blockFormat" title="–§–æ—Ä–º–∞—Ç –±–ª–æ–∫—É">
          <option value="p">–ê–±–∑–∞—Ü</option>
          <option value="h1">H1</option>
          <option value="h2">H2</option>
          <option value="h3">H3</option>
        </select>
        <button type="button" data-cmd="bold"><b>B</b></button>
        <button type="button" data-cmd="italic"><i>I</i></button>
        <button type="button" data-cmd="underline"><u>U</u></button>
        <button type="button" data-cmd="insertUnorderedList">‚Ä¢ –°–ø–∏—Å–æ–∫</button>
        <button type="button" data-cmd="insertOrderedList">1. –°–ø–∏—Å–æ–∫</button>
        <button type="button" id="mkLink">–ü–æ—Å–∏–ª–∞–Ω–Ω—è</button>
        <button type="button" id="rmLink">–ü—Ä–∏–±—Ä–∞—Ç–∏ –ø–æ—Å–∏–ª–∞–Ω–Ω—è</button>
        <button type="button" id="clearFmt">–û—á–∏—Å—Ç–∏—Ç–∏ —Ñ–æ—Ä–º–∞—Ç—É–≤–∞–Ω–Ω—è</button>
      </div>
      <div id="editor" contenteditable="true"></div>
    </section>

    <!-- –ü–†–ê–í–ê –ü–ê–ù–ï–õ–¨ -->
    <section class="panel" aria-label="HTML-–∫–æ–¥">
      <h2>HTML-–∫–æ–¥</h2>
      <textarea id="code" spellcheck="false" placeholder="–¢—É—Ç –∑‚Äô—è–≤–∏—Ç—å—Å—è HTML‚Ä¶"></textarea>
      <div class="foot-btns">
        <button class="btn" id="btnClean">–û—á–∏—Å—Ç–∏—Ç–∏</button>
        <button class="btn secondary" id="btnUndo" disabled>–ù–∞–∑–∞–¥</button>
        <button class="btn secondary" id="fontPlus" title="A+">A+</button>
        <button class="btn secondary" id="fontMinus" title="A-">A‚àí</button>
        <button class="btn" id="btnCopy">–ö–æ–ø—ñ—é–≤–∞—Ç–∏</button>
      </div>
    </section>

    <!-- –ù–ò–ñ–ù–Ü –ë–õ–û–ö–ò -->
    <section class="lower">
      <!-- –õ–Ü–í–û–†–£–ß: –ó–ê–ì–ê–õ–¨–ù–Ü –û–ü–¶–Ü–á -->
      <div class="card">
        <h3>–û–ø—Ü—ñ—ó –æ—á–∏—â–µ–Ω–Ω—è</h3>
        <div class="options">
          <label><input type="checkbox" id="opt-remove-links"> –í–∏–¥–∞–ª–∏—Ç–∏ –ø–æ—Å–∏–ª–∞–Ω–Ω—è (–∑–∞–ª–∏—à–∏—Ç–∏ —Ç–µ–∫—Å—Ç)</label>
          <label><input type="checkbox" id="opt-remove-images"> –í–∏–¥–∞–ª–∏—Ç–∏ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è</label>
          <label><input type="checkbox" id="opt-remove-empty"> –í–∏–¥–∞–ª–∏—Ç–∏ –ø–æ—Ä–æ–∂–Ω—ñ —Ç–µ–≥–∏</label>
          <label><input type="checkbox" id="opt-nbsp-to-space"> –ó–∞–º—ñ–Ω–∏—Ç–∏ &amp;nbsp; –Ω–∞ –ø—Ä–æ–±—ñ–ª (—Å—Ç–∏—Å–Ω—É—Ç–∏ –ø–æ—Å–ª—ñ–¥–æ–≤–Ω–æ—Å—Ç—ñ –¥–æ 1)</label>
          <label><input type="checkbox" id="opt-strong-to-h2"> –ó–∞–º—ñ–Ω–∏—Ç–∏ &lt;strong&gt; –Ω–∞ &lt;h2&gt;</label>
          <label><input type="checkbox" id="opt-em-to-h3"> –ó–∞–º—ñ–Ω–∏—Ç–∏ &lt;em&gt;/&lt;i&gt; –Ω–∞ &lt;h3&gt;</label>
        </div>
      </div>

      <!-- –ü–†–ê–í–û–†–£–ß: –ë–Ü–õ–ò–ô –°–ü–ò–°–û–ö (–ü–û–í–ï–†–ù–£–í –ù–ê –ú–Ü–°–¶–ï) -->
      <div class="card" id="whitelistCard">
        <h3>–ó–∞–ª–∏—à–∏—Ç–∏ –ë—ñ–ª–∏–π —Å–ø–∏—Å–æ–∫ —Ç–µ–≥—ñ–≤</h3>
        <span class="sub">–ö–æ–ª–∏ —É–≤—ñ–º–∫–Ω–µ–Ω–æ ‚Äî –∑–∞–ª–∏—à–∏–º–æ —Ç—ñ–ª—å–∫–∏ –æ–±—Ä–∞–Ω—ñ —Ç–µ–≥–∏, —Ä–µ—à—Ç—É —Ä–æ–∑–≥–æ—Ä–Ω–µ–º–æ.</span>
        <label style="display:block;margin-bottom:8px">
          <input type="checkbox" id="wl-enable"> –£–≤—ñ–º–∫–Ω—É—Ç–∏ –ë—ñ–ª–∏–π —Å–ø–∏—Å–æ–∫
        </label>
        <div class="cols">
          <div class="col">
            <h4>–¢–µ–∫—Å—Ç —Ç–∞ –∑–∞–≥–æ–ª–æ–≤–∫–∏</h4>
            <label><input type="checkbox" class="wl" value="p"> &lt;p&gt; ‚Äî –∞–±–∑–∞—Ü</label>
            <label><input type="checkbox" class="wl" value="h1"> &lt;h1&gt; ‚Äî –∑–∞–≥–æ–ª–æ–≤–æ–∫ 1</label>
            <label><input type="checkbox" class="wl" value="h2"> &lt;h2&gt; ‚Äî –∑–∞–≥–æ–ª–æ–≤–æ–∫ 2</label>
            <label><input type="checkbox" class="wl" value="h3"> &lt;h3&gt; ‚Äî –∑–∞–≥–æ–ª–æ–≤–æ–∫ 3</label>
            <label><input type="checkbox" class="wl" value="strong"> &lt;strong&gt; ‚Äî –∂–∏—Ä–Ω–∏–π</label>
            <label><input type="checkbox" class="wl" value="em"> &lt;em&gt; ‚Äî –∫—É—Ä—Å–∏–≤</label>
            <label><input type="checkbox" class="wl" value="a"> &lt;a&gt; ‚Äî –ø–æ—Å–∏–ª–∞–Ω–Ω—è</label>
          </div>
          <div class="col">
            <h4>–°–ø–∏—Å–∫–∏</h4>
            <label><input type="checkbox" class="wl" value="ul"> &lt;ul&gt; ‚Äî –º–∞—Ä–∫–æ–≤–∞–Ω–∏–π —Å–ø–∏—Å–æ–∫</label>
            <label><input type="checkbox" class="wl" value="ol"> &lt;ol&gt; ‚Äî –Ω—É–º–µ—Ä–æ–≤–∞–Ω–∏–π —Å–ø–∏—Å–æ–∫</label>
            <label><input type="checkbox" class="wl" value="li"> &lt;li&gt; ‚Äî –ø—É–Ω–∫—Ç —Å–ø–∏—Å–∫—É</label>
          </div>
        </div>
      </div>

      <!-- –ü–û–®–£–ö / –ó–ê–ú–Ü–ù–ê -->
      <div class="card" style="grid-column:1/-1">
        <h3>–ü–æ—à—É–∫ —ñ –∑–∞–º—ñ–Ω–∞ —É –≤–∏—Ö—ñ–¥–Ω–æ–º—É HTML</h3>
        <span class="sub">–í–∏–∫–æ–Ω—É—î—Ç—å—Å—è –ø—ñ—Å–ª—è –æ—á–∏—â–µ–Ω–Ω—è; —á—É—Ç–ª–∏–≤–∏–π –¥–æ —Ä–µ–≥—ñ—Å—Ç—Ä—É.</span>
        <div id="findBox"></div>
        <button class="btn secondary" id="btnAddRow">+ –î–æ–¥–∞—Ç–∏ –ø–æ–ª–µ</button>
      </div>
    </section>
  </main>

  <script>
    /* ===== DOM –ø–æ—Å–∏–ª–∞–Ω–Ω—è ===== */
    const editor = document.getElementById('editor');
    const codeArea = document.getElementById('code');
    const undoBtn = document.getElementById('btnUndo');
    const fontPlus = document.getElementById('fontPlus');
    const fontMinus = document.getElementById('fontMinus');
    const btnCopy = document.getElementById('btnCopy');
    const blockFormat = document.getElementById('blockFormat');
    const mkLink = document.getElementById('mkLink');
    const rmLink = document.getElementById('rmLink');
    const clearFmt = document.getElementById('clearFmt');
    const wlEnable = document.getElementById('wl-enable');
    const wlChecks = Array.from(document.querySelectorAll('.wl'));
    const themeBtn = document.getElementById('themeBtn');
    const themeIcon = document.getElementById('themeIcon');
    const themeText = document.getElementById('themeText');

    /* ===== –¢–ï–ú–ê (—ñ–∫–æ–Ω–∫–∞ –ø–æ–≤–µ—Ä–Ω–µ–Ω–∞) ===== */
    function setTheme(light){
      document.body.classList.toggle('theme-light', light);
      document.body.classList.toggle('theme-dark', !light);
      themeIcon.textContent = light ? '‚òÄÔ∏è' : 'üåô';
      themeText.textContent = light ? '–î–µ–Ω–Ω–∞ —Ç–µ–º–∞' : '–ù—ñ—á–Ω–∞ —Ç–µ–º–∞';
    }
    themeBtn.addEventListener('click', ()=> setTheme(!document.body.classList.contains('theme-light')));
    setTheme(false); // —Å—Ç–∞—Ä—Ç ‚Äî –Ω—ñ—á–Ω–∞

    /* ===== –¢—É–ª–±–∞—Ä ===== */
    document.querySelectorAll('.toolbar [data-cmd]').forEach(btn=>{
      btn.addEventListener('click',()=>{
        document.execCommand(btn.dataset.cmd,false);
        editor.focus(); syncToCode();
      });
    });
    blockFormat.addEventListener('change',()=>{
      document.execCommand('formatBlock',false,blockFormat.value);
      editor.focus(); syncToCode();
    });
    mkLink.addEventListener('click',()=>{
      const url = prompt('–ü–æ—Å–∏–ª–∞–Ω–Ω—è (URL):','https://'); if(!url) return;
      document.execCommand('createLink',false,url); syncToCode();
    });
    rmLink.addEventListener('click',()=>{ document.execCommand('unlink'); syncToCode(); });
    clearFmt.addEventListener('click',()=>{
      document.execCommand('removeFormat');
      editor.querySelectorAll('span').forEach(s=>s.replaceWith(...s.childNodes));
      syncToCode();
    });

    /* ===== –•–µ–ª–ø–µ—Ä–∏ ===== */
    const undoStack=[];
    function pushUndo(){ undoStack.push(codeArea.value); undoBtn.disabled=false; }
    undoBtn.addEventListener('click',()=>{
      if(!undoStack.length) return;
      codeArea.value = undoStack.pop();
      if(!undoStack.length) undoBtn.disabled=true;
    });
    function updateCodeFont(d){
      const cur = parseInt(getComputedStyle(document.documentElement).getPropertyValue('--code-size')||'14',10);
      const px = Math.max(10,Math.min(28,cur+d));
      document.documentElement.style.setProperty('--code-size',px+'px');
    }
    fontPlus.addEventListener('click',()=>updateCodeFont(+1));
    fontMinus.addEventListener('click',()=>updateCodeFont(-1));
    btnCopy.addEventListener('click',async()=>{
      try{ await navigator.clipboard.writeText(codeArea.value); btnCopy.textContent='–°–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ!'; setTimeout(()=>btnCopy.textContent='–ö–æ–ø—ñ—é–≤–∞—Ç–∏',1200); }
      catch(e){ codeArea.select(); document.execCommand('copy'); }
    });

    /* ===== –°–∞–Ω—ñ—Ç–∏–∑–∞—Ü—ñ—è –≤—Å—Ç–∞–≤–∫–∏ (–†–û–ë–õ–Æ –¢–Ü–õ–¨–ö–ò –¢–ï, –©–û –ü–†–û–°–ò–í) =====
       - –ø—Ä–∏–±–∏—Ä–∞—é dir=*, class/id/data-*, style
       - —Ä–æ–∑–≥–æ—Ä—Ç–∞—é –∑–∞–π–≤—ñ <span>, <div> ‚Üí <p>
       - <b>/<i> ‚Üí <strong>/<em>
       - —Å–∫–ª–µ–π–∫–∞ ¬Æ ‚Ñ¢ ¬© –∑ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ–º —Å–ª–æ–≤–æ–º
    */
    function sanitizeOnPaste(rawHtml, rawText){
      let html = rawHtml && rawHtml.trim() ? rawHtml : '';
      if(!html){
        // —è–∫—â–æ –±—É—Ñ–µ—Ä ‚Äî plain text: —Ä–æ–±–∏–º–æ <p> –ø–æ —Ä—è–¥–∫–∞—Ö
        const t = (rawText||'').replace(/\r\n?/g,'\n').split('\n').map(s=>s.trim()).filter(Boolean);
        html = t.map(s=>`<p>${s}</p>`).join('');
      }
      // –∑–Ω—ñ–º–∞—î–º–æ –¥–∏—Ä–µ–∫—Ç–∏–≤–∏ —Ç–∞ —Å—Ç–∏–ª—ñ/–∫–ª–∞—Å–∏
      html = html
        .replace(/\sdir\s*=\s*"(?:ltr|rtl)"/gi,'')
        .replace(/\sstyle\s*=\s*"[^"]*"/gi,'')
        .replace(/\sclass\s*=\s*"[^"]*"/gi,'')
        .replace(/\sid\s*=\s*"[^"]*"/gi,'')
        .replace(/\sdata-[\w-]+\s*=\s*"[^"]*"/gi,'');

      // –Ω–æ—Ä–º–∞–ª—ñ–∑–∞—Ü—ñ—è —Ç–µ–≥—ñ–≤
      html = html
        .replace(/<\s*b(\s|>)/gi,'<strong$1').replace(/<\/\s*b\s*>/gi,'</strong>')
        .replace(/<\s*i(\s|>)/gi,'<em$1').replace(/<\/\s*i\s*>/gi,'</em>')
        .replace(/<\s*div(\s|>)/gi,'<p$1').replace(/<\/\s*div\s*>/gi,'</p>')
        .replace(/<span[^>]*>/gi,'').replace(/<\/span>/gi,'');

      // —Å–∫–ª–µ–π–∫–∞ —Å–∏–º–≤–æ–ª—ñ–≤ –∑–ª—ñ–≤–∞
      html = html
        .replace(/(\w|\p{L})\s*(¬Æ|‚Ñ¢|¬©|&reg;|&trade;|&copy;)/gu,'$1$2')
        // –≤–∏–ø–∞–¥–æ–∫ –æ–∫—Ä–µ–º–∏—Ö <p>¬Æ</p> –ø—ñ—Å–ª—è –∑–∞–≥–æ–ª–æ–≤–∫–∞/–∞–±–∑–∞—Ü—É
        .replace(/<\/(h[1-3]|p)>\s*<p>\s*(¬Æ|‚Ñ¢|¬©|&reg;|&trade;|&copy;)\s*<\/p>/gi,'$2</$1>');

      return html;
    }

    editor.addEventListener('paste',(e)=>{
      e.preventDefault();
      const dt = e.clipboardData || window.clipboardData;
      const clean = sanitizeOnPaste(dt.getData('text/html'), dt.getData('text'));
      document.execCommand('insertHTML',false,clean);
      syncToCode();
    });

    /* ===== –î–∑–µ—Ä–∫–∞–ª–æ –∫–æ–¥—É + pretty print (–ø–æ —Ä—è–¥–∫—É –Ω–∞ –µ–ª–µ–º–µ–Ω—Ç) ===== */
    function pretty(html){
      try{
        const doc = new DOMParser().parseFromString(`<div>${html}</div>`,'text/html');
        const root = doc.body.firstElementChild;

        const voids = new Set(['br','img','hr','meta','input','source','track','wbr','area','base','col','link','param','embed']);
        const blocks = new Set(['p','h1','h2','h3','h4','ul','ol','li','blockquote','pre','table','thead','tbody','tfoot','tr','td','th']);

        const out=[];
        function ser(node,indent){
          if(node.nodeType===3){ // text
            const t = node.nodeValue.replace(/\s+/g,' ').trim();
            if(t) out.push('  '.repeat(indent)+t);
            return;
          }
          if(node.nodeType!==1) return;
          const tag = node.tagName.toLowerCase();
          const attrs = ''; // —É–∂–µ –æ—á–∏—â–µ–Ω–æ –Ω–∞ –≤—Å—Ç–∞–≤–∫–µ/–æ—á–∏—Å—Ç–∫–µ
          if(voids.has(tag)){ out.push('  '.repeat(indent)+`<${tag}${attrs}>`); return; }

          const kids = Array.from(node.childNodes);
          const textOnly = kids.length===1 && kids[0].nodeType===3;
          if(textOnly){
            const t = kids[0].nodeValue.replace(/\s+/g,' ').trim();
            out.push('  '.repeat(indent)+`<${tag}${attrs}>${t}</${tag}>`);
          }else{
            out.push('  '.repeat(indent)+`<${tag}${attrs}>`);
            kids.forEach(ch=>ser(ch, indent+(blocks.has(tag)?1:0)));
            out.push('  '.repeat(indent)+`</${tag}>`);
          }
        }
        Array.from(root.childNodes).forEach(n=>ser(n,0));
        return out.join('\n');
      }catch(e){ return html; }
    }
    function syncToCode(){ codeArea.value = pretty(editor.innerHTML); }
    editor.addEventListener('input',syncToCode);

    /* ===== –ü–æ—à—É–∫ / –ó–∞–º—ñ–Ω–∞ ===== */
    const findBox = document.getElementById('findBox');
    function addFindRow(a='',b=''){
      const row = document.createElement('div');
      row.className='find-row';
      row.innerHTML = `<input placeholder="–©–æ –∑–Ω–∞–π—Ç–∏" value="${a.replaceAll('"','&quot;')}">
                       <input placeholder="–ù–∞ —â–æ –∑–∞–º—ñ–Ω–∏—Ç–∏" value="${b.replaceAll('"','&quot;')}">
                       <button type="button" class="btn secondary">–í–∏–¥–∞–ª–∏—Ç–∏</button>`;
      row.lastElementChild.addEventListener('click',()=>row.remove());
      findBox.appendChild(row);
    }
    document.getElementById('btnAddRow').addEventListener('click',()=>addFindRow());
    addFindRow();

    /* ===== –ö–Ω–æ–ø–∫–∞ ¬´–û—á–∏—Å—Ç–∏—Ç–∏¬ª =====
       ‚Äî –Ω–µ —á—ñ–ø–∞—é –Ω—ñ—á–æ–≥–æ –∑–∞–π–≤–æ–≥–æ; –ø—Ä–∞—Ü—é—î –∑ –±—ñ–ª–∏–º —Å–ø–∏—Å–∫–æ–º —ñ –±–∞–∑–æ–≤–∏–º–∏ –æ–ø—Ü—ñ—è–º–∏
    */
    function qAll(root,sel){ return Array.from(root.querySelectorAll(sel)); }
    function unwrap(el){ const p=el.parentNode; while(el.firstChild) p.insertBefore(el.firstChild,el); p.removeChild(el); }
    function replaceTag(el,tag){ const neo=el.ownerDocument.createElement(tag); while(el.firstChild) neo.appendChild(el.firstChild); el.replaceWith(neo); return neo; }

    document.getElementById('btnClean').addEventListener('click',()=>{
      pushUndo();
      let html = codeArea.value || editor.innerHTML || '';

      const doc = new DOMParser().parseFromString(`<div id="r">${html}</div>`,'text/html');
      const root = doc.getElementById('r');

      // –æ–ø—Ü—ñ—ó
      const opt = {
        rmLinks: document.getElementById('opt-remove-links').checked,
        rmImgs: document.getElementById('opt-remove-images').checked,
        rmEmpty: document.getElementById('opt-remove-empty').checked,
        nbspToSpace: document.getElementById('opt-nbsp-to-space').checked,
        strongToH2: document.getElementById('opt-strong-to-h2').checked,
        emToH3: document.getElementById('opt-em-to-h3').checked,
        wl: wlEnable.checked,
        wlSet: new Set(wlChecks.filter(c=>c.checked).map(c=>c.value))
      };

      // –±–∞–∑–æ–≤—ñ –¥—ñ—ó
      if(opt.rmImgs) qAll(root,'img').forEach(n=>n.remove());
      if(opt.rmLinks) qAll(root,'a').forEach(unwrap);
      if(opt.strongToH2) qAll(root,'strong').forEach(n=>replaceTag(n,'h2'));
      if(opt.emToH3) qAll(root,'em,i').forEach(n=>replaceTag(n,'h3'));

      // –ë—ñ–ª–∏–π —Å–ø–∏—Å–æ–∫: –ø—Ä–∏–±–∏—Ä–∞—î–º–æ –í–°–Ü –∞—Ç—Ä–∏–±—É—Ç–∏ —Ç–∞ —Ä–æ–∑–≥–æ—Ä—Ç–∞—î–º–æ –Ω–µ –¥–æ–∑–≤–æ–ª–µ–Ω—ñ —Ç–µ–≥–∏
      if(opt.wl){
        qAll(root,'*').forEach(el=>{
          // –∑–Ω—ñ–º–∞—î–º–æ –≤—Å—ñ –∞—Ç—Ä–∏–±—É—Ç–∏ (–≤–∫–ª—é—á–Ω–æ –∑ dir/style), —è–∫ –ø—Ä–æ—Å–∏–≤
          [...el.attributes].forEach(a=>el.removeAttribute(a.name));
          // –Ω–æ—Ä–º–∞–ª—ñ–∑–∞—Ü—ñ—è b/i
          if(el.tagName==='B') replaceTag(el,'strong');
          if(el.tagName==='I') replaceTag(el,'em');
        });
        qAll(root,'*').forEach(el=>{
          const tag = el.tagName.toLowerCase();
          if(!opt.wlSet.has(tag)){
            // —Å–ø–µ—Ü–≤–∏–ø–∞–¥–æ–∫: div/span ‚Üí p, —â–æ–± –Ω–µ –≥—É–±–∏—Ç–∏ –∞–±–∑–∞—Ü–∏
            if(tag==='div'||tag==='span'){ replaceTag(el,'p'); }
            else if(tag!=='body' && tag!=='html' && tag!=='#document'){ unwrap(el); }
          }
        });
      }

      // —á–∏—Å—Ç–∏–º–æ –ø–æ—Ä–æ–∂–Ω—î
      if(opt.rmEmpty){
        let changed;
        const onlySpace = s=>!s || s.replace(/\u00A0|&nbsp;|\s/g,'')==='';
        do{
          changed=false;
          qAll(root,'*').forEach(el=>{
            if(!el.firstElementChild && onlySpace(el.textContent)) { el.remove(); changed=true; }
          });
        }while(changed);
      }

      html = root.innerHTML;

      if(opt.nbspToSpace){
        html = html.replace(/(?:&nbsp;|\u00A0)+/g,' ');
        html = html.replace(/ {2,}/g,' ');
      }

      // —Å–∫–ª–µ–π–∫–∞ —Å–∏–º–≤–æ–ª—ñ–≤ —Ç–æ—Ä–≥–æ–≤–∏—Ö –º–∞—Ä–æ–∫ –∑ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ–º —Å–ª–æ–≤–æ–º (–Ω–∞ –≤–∏–ø–∞–¥–æ–∫ –æ—á–∏—â–µ–Ω–Ω—è)
      html = html.replace(/(\w|\p{L})\s*(¬Æ|‚Ñ¢|¬©|&reg;|&trade;|&copy;)/gu,'$1$2');

      codeArea.value = pretty(html); // –æ–¥–∏–Ω –µ–ª–µ–º–µ–Ω—Ç ‚Äî –æ–¥–∏–Ω —Ä—è–¥–æ–∫
      editor.innerHTML = html;       // —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è –≤–ª—ñ–≤–æ (–∞–∫—Ç—É–∞–ª—å–Ω–µ –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è)
    });

    /* ===== –£–≤—ñ–º–∫–Ω–µ–Ω–æ/–≤–∏–º–∫–Ω–µ–Ω–æ –ø—ñ–¥—á–µ–∫–±–æ–∫—Å–∏ —É –ë—ñ–ª–æ–º—É —Å–ø–∏—Å–∫—É ===== */
    function toggleWLChildren(disabled){
      wlChecks.forEach(c=>{ c.disabled = disabled; c.parentElement.style.opacity = disabled?.6:1; });
    }
    wlEnable.addEventListener('change',()=>toggleWLChildren(!wlEnable.checked));
    toggleWLChildren(true); // –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º –≤–∏–º–∫–Ω–µ–Ω–æ

    /* –°—Ç–∞—Ä—Ç–æ–≤–∏–π —Ç–µ–∫—Å—Ç */
    editor.innerHTML = '<p><strong>–õ–∞—Å–∫–∞–≤–æ –ø—Ä–æ—Å–∏–º–æ!</strong> –í—Å—Ç–∞–≤—Ç–µ —Ç–µ–∫—Å—Ç –ª—ñ–≤–æ—Ä—É—á ‚Äî –ø—Ä–∞–≤–æ—Ä—É—á –æ–¥—Ä–∞–∑—É –ø–æ–±–∞—á–∏—Ç–µ —á–∏—Å—Ç–∏–π HTML —É —Å—Ç–∏–ª—ñ HTML-Cleaner. –û–±–µ—Ä—ñ—Ç—å –æ–ø—Ü—ñ—ó —ñ –Ω–∞—Ç–∏—Å–Ω—ñ—Ç—å <em>–û—á–∏—Å—Ç–∏—Ç–∏</em>.</p>';
    codeArea.value = pretty(editor.innerHTML);
  </script>
</body>
</html>
